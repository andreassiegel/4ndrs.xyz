<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Andreas Siegel"><meta name=description content="some guy passionate about IT and other things"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Connect to a VPN from the Command Line on Mac OS"><meta name=twitter:description content="During Corona time, I have to connect to a VPN most of the time in order to work. I use two different VPNs depending on what I&rsquo;m working on. I can select the network to connect to from the status bar at the top of the screen but there seems to be a bug: Sometimes there isn&rsquo;t anything to select, so I have to go to the network preferences and connect from there."><meta property="og:title" content="Connect to a VPN from the Command Line on Mac OS"><meta property="og:description" content="During Corona time, I have to connect to a VPN most of the time in order to work. I use two different VPNs depending on what I&rsquo;m working on. I can select the network to connect to from the status bar at the top of the screen but there seems to be a bug: Sometimes there isn&rsquo;t anything to select, so I have to go to the network preferences and connect from there."><meta property="og:type" content="article"><meta property="og:url" content="https://4ndrs.xyz/posts/macos-vpn-command-line/"><meta property="article:published_time" content="2020-05-03T11:53:55+02:00"><meta property="article:modified_time" content="2020-05-03T11:53:55+02:00"><base href=https://4ndrs.xyz/posts/macos-vpn-command-line/><title>Connect to a VPN from the Command Line on Mac OS · 4ndrs.xyz</title><link rel=canonical href=https://4ndrs.xyz/posts/macos-vpn-command-line/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.11.2/css/all.css integrity=sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://4ndrs.xyz/css/coder.min.365fc6d23b8b25f2390eead64f5fb2e5b371942dc4ba4f105deb7dd6962de016.css integrity="sha256-Nl/G0juLJfI5DurWT1+y5bNxlC3Euk8QXet91pYt4BY=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://4ndrs.xyz/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://4ndrs.xyz/images/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.69.0"></head><body class=colorscheme-light><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://4ndrs.xyz/>4ndrs.xyz</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://4ndrs.xyz/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://4ndrs.xyz/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://4ndrs.xyz/categories/>Categories</a></li><li class=navigation-item><a class=navigation-link href=https://4ndrs.xyz/contact/>Contact me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Connect to a VPN from the Command Line on Mac OS</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i><time datetime=2020-05-03T11:53:55+02:00>May 3, 2020</time></span>
<span class=reading-time><i class="fas fa-clock"></i>4-minute read</span></div><div class=categories><i class="fas fa-folder"></i><a href=https://4ndrs.xyz/categories/tips-tricks/>Tips & Tricks</a></div><div class=tags><i class="fas fa-tag"></i><a href=https://4ndrs.xyz/tags/cli/>cli</a>
<span class=separator>•</span>
<a href=https://4ndrs.xyz/tags/vpn/>vpn</a>
<span class=separator>•</span>
<a href=https://4ndrs.xyz/tags/keychain/>keychain</a>
<span class=separator>•</span>
<a href=https://4ndrs.xyz/tags/mac/>mac</a></div></div></header><div><p>During Corona time, I have to connect to a VPN most of the time in order to work.
I use two different VPNs depending on what I&rsquo;m working on.
I can select the network to connect to from the status bar at the top of the screen
but there seems to be a bug: Sometimes there isn&rsquo;t anything to select,
so I have to go to the network preferences and connect from there.</p><p>This works, but it also bothers me. Most of what I do frequently can be done from the command line.
There must be a way to also connect to a VPN from there!</p><p>It turned out there are multiple ways, actually.
Prerequisite is that the VPN has been configured in the network preferences.</p><h2 id=use-networksetup>Use <code>networksetup</code></h2><p>The <code>networksetup</code> command provides access to network settings that are usually configured in the <em>System Preferences</em> application.</p><p>Use this command to connect the VPN configured with the name &ldquo;myVPN&rdquo;:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ networksetup -connectpppoeservice <span style=color:#4070a0>&#34;myVPN&#34;</span>
</code></pre></div><p>The following command will disconnect again:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ networksetup -disconnectpppoeservice <span style=color:#4070a0>&#34;myVPN&#34;</span>
</code></pre></div><p>If you want to check the connection status, use:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ networksetup -showpppoestatus <span style=color:#4070a0>&#34;myVPN&#34;</span>
</code></pre></div><h2 id=use-scutil>Use <code>scutil</code></h2><p>The &ldquo;system configuration utility&rdquo; or <code>scutil</code> command provides access to network configuration, too.</p><p>To connect to your VPN, use this command:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ scutil --nc start <span style=color:#4070a0>&#34;myVPN&#34;</span>
</code></pre></div><p>Execute the following command to disconnect from the VPN:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ scutil --nc stop <span style=color:#4070a0>&#34;myVPN&#34;</span>
</code></pre></div><p>If you want to check the connection status, use:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ scutil --nc status <span style=color:#4070a0>&#34;myVPN&#34;</span>
</code></pre></div><h2 id=connect-with-password-from-keychain>Connect with Password from Keychain</h2><p>Both mentioned commands work with the built-in VPN client.
Unfortunately, it is required to enter the password every time I connect because the account password is not stored in the keychain.
People are discussing for years now whether this is actually a bug or a feature of the built-in VPN client in Mac OS.</p><p>Installing another VPN client might solve that problem but you can also use a script as a workaround.</p><p>A script or at least an alias is a good idea anyway because I&rsquo;d like to have something as short as <code>vpn connect "myVPN"</code>.
It would be a great plus if that wouldn&rsquo;t even ask me to enter a password but retrieves it from the keychain instead.</p><p>Looking at the keychains in the <em>Keychain Access</em> application, I see only entries of kind <em>IPSec Shared Secret</em> in the system keychain and nothing in the login keychain or local items.
Thus, as of now, there isn&rsquo;t anything to retrieve the password from.</p><h3 id=add-the-vpn-account-password-to-the-keychain>Add the VPN Account Password to the Keychain</h3><p>To fix that, we first of all add the account password to the login keychain:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ security add-generic-password <span style=color:#4070a0;font-weight:700>\
</span><span style=color:#4070a0;font-weight:700></span>  -D <span style=color:#4070a0>&#34;VPN account password&#34;</span> <span style=color:#4070a0;font-weight:700>\
</span><span style=color:#4070a0;font-weight:700></span>  -s <span style=color:#4070a0>&#34;myVPN&#34;</span> <span style=color:#4070a0;font-weight:700>\
</span><span style=color:#4070a0;font-weight:700></span>  -a <span style=color:#4070a0>&#34;myUserAccount@myVPN&#34;</span> <span style=color:#4070a0;font-weight:700>\
</span><span style=color:#4070a0;font-weight:700></span>  -w <span style=color:#4070a0>&#34;mySuperStrongPassword&#34;</span> <span style=color:#4070a0;font-weight:700>\
</span><span style=color:#4070a0;font-weight:700></span>  -T <span style=color:#4070a0>&#34;/usr/bin/security&#34;</span>
</code></pre></div><ul><li><code>-a</code> specifies your VPN account name (required)</li><li><code>-D</code> specifies the kind of the keychain entry (optional, default is &ldquo;application password&rdquo;)</li><li><code>-s</code> specifies the service name (the name of the keychain entry, required)</li><li><code>-T</code> specifies an application which may access the keychain entry (multiple <code>-T</code> options are possible)</li><li><code>-w</code> specified your VPN account password</li></ul><p>The <code>-s</code> option should match the name of your configured VPN because we will use it to retrieve the account password from the keychain.</p><h3 id=create-a-utility-script>Create a Utility Script</h3><p>Next, we will create a utility script that uses the keychain entry we just created:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ <span style=color:#007020>echo</span> <span style=color:#4070a0>&#39;#!/bin/bash&#39;</span> &gt; ~/vpnConnection.sh <span style=color:#666>&amp;&amp;</span> chmod +x ~/vpnConnection.sh
</code></pre></div><p>This creates the <code>vpnConnection.sh</code> bash script in the home directory and makes it executable.</p><p>Open the script in an editor, and add this code:</p><script type=application/javascript src=https://gist.github.com/andreassiegel/4792195cf1c9425ae09be6b3f23c908c.js></script><p>With that script, you can now use these commands:</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>~/vpnConnection.sh list</code></td><td>show all VPN connections</td></tr><tr><td><code>~/vpnConnection.sh connect "myVPN"</code></td><td>connect to the VPN &ldquo;myVPN&rdquo; and automatically enter the password</td></tr><tr><td><code>~/vpnConnection.sh disconnect "myVPN"</code></td><td>disconnect to the VPN &ldquo;myVPN&rdquo;</td></tr><tr><td><code>~/vpnConnection.sh status "myVPN"</code></td><td>show the connection status for VPN &ldquo;myVPN&rdquo;</td></tr></tbody></table><h3 id=configure-privacy>Configure Privacy</h3><p>If you run the script now, you might get an error like this:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>execution error: System Events got an error: osascript is not allowed to send keystrokes. (1002)
</code></pre></div><p>In this case, you will have to <a href=https://support.apple.com/guide/mac-help/allow-accessibility-apps-to-access-your-mac-mh43185/mac>configure your <em>Privacy</em> settings</a>:</p><ol><li>Go to <em>System Preferences > Security & Privacy</em></li><li>Select the <em>Privacy</em> tab</li><li>Select <em>Accessibility</em></li><li>Unlock the configuration if necessary</li><li>Click the <em>+</em> button</li><li>Press <code>Cmd+Shift+G</code> in the Finder window that opens</li><li>Enter <code>/usr/bin/osascript</code> and click <em>Go</em></li><li>Click <em>Open</em></li></ol><p>This will allow <code>osascript</code> to control your computer, i.e.,
to automatically interact with the Mac OS user interface.</p><p>You might also have to add your terminal application (e.g., <em>iTerm</em>) to that list.</p><h3 id=set-an-alias>Set an Alias</h3><p>With that, it is already pretty convenient to manage VPN connections.
To make it even more convenient, we will also set an alias so that we can type <code>vpn</code> instead of <code>~/vpnConnection.sh</code>.</p><p>Add the following line to the configuration of your shell, e.g., <code>~/.zshrc</code> or <code>~/.bashrc</code>:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#007020>alias</span> <span style=color:#bb60d5>vpn</span><span style=color:#666>=</span><span style=color:#4070a0>&#34;~/vpnConnection.sh&#34;</span>
</code></pre></div><p>Now, using VPN connections is as easy as this:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ vpn list
$ vpn connect <span style=color:#4070a0>&#34;myVPN&#34;</span>
$ vpn status <span style=color:#4070a0>&#34;myVPN&#34;</span>
$ vpn disconnect <span style=color:#4070a0>&#34;myVPN&#34;</span>
</code></pre></div></div><footer><section class=see-also></section><h2>See Also</h2><ul><li><a href=https://4ndrs.xyz/posts/multiple-tool-versions-via-homebrew/>Multiple Tool Versions via Homebrew</a></li><li><a href=https://4ndrs.xyz/posts/nodejs-test-intellij/>JavaScript Testing with Jest in IntelliJ IDEA</a></li><li><a href=https://4ndrs.xyz/contact/>Say Hello</a></li></ul><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"4ndrs-xyz"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></section></div><footer class=footer><section class=container>©
2017 -
2020
Andreas Siegel</section></footer></main><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-431647-14','auto');ga('send','pageview');}</script></body></html>